{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Administrator/Desktop/FrontEnd_ThayLong_Nhom-21/app-chat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { ChatPageObjectGroupWS } from 'src/app/models/ws/chat-page/chat-page-friends-page/chat_page_object_group_ws';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/database\";\nimport * as i2 from \"./chat-page-friends-websocket.service\";\nexport class ChatPageCreateGroupWsService {\n  constructor(db, chat_page_friends_websocket) {\n    this.db = db;\n    this.chat_page_friends_websocket = chat_page_friends_websocket;\n    this.init();\n  }\n\n  createGroup(ten_nhom, ten) {\n    var _this = this;\n\n    let ma_tai_khoan = JSON.parse(localStorage.getItem(\"ma_tai_khoan_dn_ws\"));\n    let currentTime = Number(new Date());\n    let value = \"error\";\n    this.chat_page_friends_websocket.createGroup(ten_nhom);\n    this.chat_page_friends_websocket.messages_create_group_chat.subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (data) {\n        value = JSON.parse(JSON.stringify(data)).status;\n\n        if ((yield value) == \"success\") {\n          // Cuộc trò chuyện\n          let cuoc_tro_chuyen = _this.db.list(\"/cuoc_tro_chuyen_ws\").push({\n            loai_cuoc_tro_truyen: \"nhom\",\n            bieu_tuong_cam_xuc: \"khong\",\n            mau: \"#3275f7\"\n          }); // Thông tin trò chuyện nhóm\n\n\n          _this.db.object(\"/thong_tin_tro_chuyen_nhom_ws/\" + cuoc_tro_chuyen.key).update({\n            chu_so_huu: ma_tai_khoan,\n            ngay_tao: currentTime,\n            [\"ten_nhom\"]: ten_nhom,\n            ton_tai: 0\n          }); // Thành viên cuộc trò chuyện\n\n\n          _this.db.object(\"/thanh_vien_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key + \"/\" + ma_tai_khoan).update({\n            ngay_roi_di: 0,\n            ngay_tham_gia: currentTime,\n            roi_chua: \"chua\",\n            trang_thai: \"khong_cho\",\n            chuc_vu: 'quan_tri_vien',\n            tham_gia: \"roi\"\n          });\n\n          let array = [];\n          array.push({\n            ma_tai_khoan: ma_tai_khoan,\n            ngay_nhan: 0,\n            ngay_xem: currentTime,\n            xem_chua: \"roi\",\n            ten: ten\n          });\n\n          for (let i = 0; i < _this.user_added.length; i++) {\n            _this.db.object(\"/thanh_vien_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key + \"/\" + _this.user_added[i].ma_tai_khoan).update({\n              ngay_roi_di: 0,\n              ngay_tham_gia: currentTime,\n              roi_chua: \"chua\",\n              trang_thai: \"khong_cho\",\n              chuc_vu: 'thanh_vien',\n              tham_gia: \"chua\"\n            });\n\n            array.push({\n              ma_tai_khoan: _this.user_added[i].ma_tai_khoan,\n              ngay_nhan: 0,\n              ngay_xem: 0,\n              xem_chua: \"chua\",\n              ten: _this.user_added[i].ten\n            });\n          } // Tin nhắn đầu tiên\n\n\n          _this.db.list(\"/chi_tiet_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key).push({\n            dia_chi_file: \"\",\n            link_file: \"\",\n            loai_tin_nhan: \"thong_bao\",\n            [\"ma_tai_khoan\"]: ma_tai_khoan,\n            ten: ten,\n            ma_tin_nhan_phan_hoi: \"\",\n            ngay_gui: currentTime,\n            noi_dung: \"đã tạo nhóm\"\n          }).then(ref => {\n            for (let i = 0; i < array.length; i++) {\n              _this.db.object(\"/chi_tiet_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key + \"/\" + ref.key + \"/tinh_trang_xem/\" + array[i]['ma_tai_khoan']).update({\n                ngay_nhan: array[i]['ngay_nhan'],\n                ngay_xem: array[i]['ngay_xem'],\n                xem_chua: array[i]['xem_chua'],\n                ten: array[i]['ten']\n              });\n            }\n\n            ;\n          });\n\n          _this.checkCreate = true;\n        } else _this.checkCreate = false;\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n  fillter(value) {\n    this.user_search = [];\n    let ma_tai_khoan = JSON.parse(localStorage.getItem(\"ma_tai_khoan_dn_ws\"));\n\n    if (value.length > 0) {\n      for (let i = 0; i < this.all_user.length; i++) {\n        if (this.all_user[i].ma_tai_khoan != ma_tai_khoan) {\n          if (this.all_user[i].ten.trim().toLowerCase().includes(value.trim().toLowerCase())) {\n            if (this.isNotInAdded(this.all_user[i].ma_tai_khoan)) {\n              this.user_search.push(new ChatPageObjectGroupWS(this.all_user[i].ten, this.all_user[i].ma_tai_khoan, this.all_user[i].hinh));\n            }\n          }\n        }\n      }\n    }\n  }\n\n  clearAdded(ma_tai_khoan) {\n    let index = -1;\n\n    for (let i = 0; i < this.user_added.length; i++) {\n      if (this.user_added[i].ma_tai_khoan == ma_tai_khoan) {\n        index = i;\n        break;\n      }\n    }\n\n    if (index != -1) {\n      this.user_added.splice(index, 1);\n    }\n  }\n\n  updateSearch(ten_hien_tai, ma_tai_khoan) {\n    let ma_tai_khoan_dn_ws = JSON.parse(localStorage.getItem(\"ma_tai_khoan_dn_ws\"));\n\n    if (ten_hien_tai.trim().length > 0) {\n      for (let i = 0; i < this.all_user.length; i++) {\n        if (this.all_user[i].ma_tai_khoan != ma_tai_khoan_dn_ws) {\n          if (this.all_user[i].ma_tai_khoan == ma_tai_khoan) {\n            let ten = this.all_user[i].ten;\n\n            if (ten.trim().toLowerCase().includes(ten_hien_tai.trim().toLowerCase())) {\n              this.user_search.push(new ChatPageObjectGroupWS(this.all_user[i].ten, this.all_user[i].ma_tai_khoan, this.all_user[i].hinh));\n            }\n\n            return;\n          }\n        }\n      }\n    }\n  }\n\n  isNotInAdded(ma_tai_khoan) {\n    for (let i = 0; i < this.user_added.length; i++) {\n      if (this.user_added[i].ma_tai_khoan == ma_tai_khoan) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  selectUser(ma_tai_khoan) {\n    for (let i = 0; i < this.all_user.length; i++) {\n      if (this.all_user[i].ma_tai_khoan == ma_tai_khoan) {\n        this.user_added.push(new ChatPageObjectGroupWS(this.all_user[i].ten, this.all_user[i].ma_tai_khoan, this.all_user[i].hinh));\n        this.user_search = [];\n        return;\n      }\n    }\n  }\n\n  getAllUser() {\n    return this.db.object(\"/tai_khoan_ws\").snapshotChanges();\n  }\n\n  off() {\n    this.isshow = false;\n    this.init();\n  }\n\n  init() {\n    this.user_added = [];\n    this.user_search = [];\n  }\n\n  isOke() {\n    return this.user_added.length != 0;\n  }\n\n}\n\nChatPageCreateGroupWsService.ɵfac = function ChatPageCreateGroupWsService_Factory(t) {\n  return new (t || ChatPageCreateGroupWsService)(i0.ɵɵinject(i1.AngularFireDatabase), i0.ɵɵinject(i2.ChatPageFriendsWebsocketService));\n};\n\nChatPageCreateGroupWsService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ChatPageCreateGroupWsService,\n  factory: ChatPageCreateGroupWsService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["C:\\Users\\Administrator\\Desktop\\FrontEnd_ThayLong_Nhom-21\\app-chat\\src\\app\\service\\ws\\chat-page\\chat-page-friends-page\\chat-page-create-group-ws.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { AngularFireDatabase } from '@angular/fire/database';\r\nimport { Subscription } from 'rxjs';\r\nimport { ChatPageObjectGroupWS } from 'src/app/models/ws/chat-page/chat-page-friends-page/chat_page_object_group_ws';\r\nimport { ChatPageFriendsWebsocketService } from './chat-page-friends-websocket.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ChatPageCreateGroupWsService {\r\n  // kiểm tra tạo mới\r\n  public checkCreate: boolean;\r\n  public isshow: boolean;\r\n  // Danh sach tất cả user\r\n  public all_user: ChatPageObjectGroupWS[];\r\n  // Danh sách những người đã được thêm thêm vào\r\n  public user_added: ChatPageObjectGroupWS[];\r\n  // Danh sách gợi ý\r\n  public user_search: ChatPageObjectGroupWS[];\r\n  \r\n  // service\r\n  public layAllUser:Subscription;\r\n\r\n  constructor(\r\n    private db: AngularFireDatabase,\r\n    private chat_page_friends_websocket: ChatPageFriendsWebsocketService\r\n  ) {\r\n    this.init();\r\n  }\r\n\r\n  public createGroup(ten_nhom: string,ten:string){\r\n    let ma_tai_khoan = JSON.parse(localStorage.getItem(\"ma_tai_khoan_dn_ws\"));\r\n    let currentTime = Number(new Date());\r\n    let value = \"error\";\r\n    this.chat_page_friends_websocket.createGroup(ten_nhom);\r\n    this.chat_page_friends_websocket.messages_create_group_chat.subscribe(async data => {\r\n      value = JSON.parse(JSON.stringify(data)).status;\r\n      if (await value == \"success\") {\r\n        // Cuộc trò chuyện\r\n        let cuoc_tro_chuyen = this.db.list(\"/cuoc_tro_chuyen_ws\").push({ loai_cuoc_tro_truyen: \"nhom\", bieu_tuong_cam_xuc: \"khong\", mau: \"#3275f7\" });\r\n        // Thông tin trò chuyện nhóm\r\n        this.db.object(\"/thong_tin_tro_chuyen_nhom_ws/\" + cuoc_tro_chuyen.key).update(\r\n          {\r\n            chu_so_huu: ma_tai_khoan,\r\n            ngay_tao: currentTime,\r\n            [\"ten_nhom\"]: ten_nhom,\r\n            ton_tai: 0\r\n          }\r\n        );\r\n        // Thành viên cuộc trò chuyện\r\n        this.db.object(\"/thanh_vien_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key + \"/\" + ma_tai_khoan).update(\r\n          {\r\n            ngay_roi_di: 0,\r\n            ngay_tham_gia: currentTime,\r\n            roi_chua: \"chua\",\r\n            trang_thai: \"khong_cho\",\r\n            chuc_vu: 'quan_tri_vien',\r\n            tham_gia: \"roi\"\r\n          }\r\n        );\r\n        let array: Object[] = [];\r\n        array.push({ ma_tai_khoan: ma_tai_khoan, ngay_nhan: 0, ngay_xem: currentTime, xem_chua: \"roi\",ten:ten });\r\n        for (let i = 0; i < this.user_added.length; i++) {\r\n         \r\n          this.db.object(\"/thanh_vien_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key + \"/\" + this.user_added[i].ma_tai_khoan).update(\r\n            {\r\n              ngay_roi_di: 0,\r\n              ngay_tham_gia: currentTime,\r\n              roi_chua: \"chua\",\r\n              trang_thai: \"khong_cho\",\r\n              chuc_vu: 'thanh_vien',\r\n              tham_gia: \"chua\"\r\n            }\r\n          );\r\n          array.push({ ma_tai_khoan: this.user_added[i].ma_tai_khoan, ngay_nhan: 0, ngay_xem: 0, xem_chua: \"chua\",ten:this.user_added[i].ten });\r\n        }\r\n        // Tin nhắn đầu tiên\r\n        this.db.list(\"/chi_tiet_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key).push(\r\n          {\r\n            dia_chi_file: \"\",\r\n            link_file: \"\",\r\n            loai_tin_nhan: \"thong_bao\",\r\n            [\"ma_tai_khoan\"]: ma_tai_khoan,\r\n            ten:ten,\r\n            ma_tin_nhan_phan_hoi: \"\",\r\n            ngay_gui: currentTime,\r\n            noi_dung: \"đã tạo nhóm\"\r\n          }\r\n        ).then((ref) => {\r\n          for (let i = 0; i < array.length; i++) {\r\n            this.db.object(\"/chi_tiet_cuoc_tro_chuyen_ws/\" + cuoc_tro_chuyen.key + \"/\" + ref.key + \"/tinh_trang_xem/\" + array[i]['ma_tai_khoan']).update(\r\n              {\r\n                ngay_nhan: array[i]['ngay_nhan'],\r\n                ngay_xem: array[i]['ngay_xem'],\r\n                xem_chua: array[i]['xem_chua'],\r\n                ten:array[i]['ten']\r\n              }\r\n            )\r\n          };\r\n        });\r\n        this.checkCreate = true;\r\n      } else\r\n        this.checkCreate = false;\r\n    })\r\n          \r\n   \r\n    \r\n  }\r\n\r\n  public fillter(value: string) {\r\n    this.user_search = [];\r\n    let ma_tai_khoan = JSON.parse(localStorage.getItem(\"ma_tai_khoan_dn_ws\"));\r\n    if (value.length > 0) {\r\n      for (let i = 0; i < this.all_user.length; i++) {\r\n        if (this.all_user[i].ma_tai_khoan != ma_tai_khoan) {\r\n          if (this.all_user[i].ten.trim().toLowerCase().includes(value.trim().toLowerCase())) {\r\n            if (this.isNotInAdded(this.all_user[i].ma_tai_khoan)) {\r\n              this.user_search.push(new ChatPageObjectGroupWS(this.all_user[i].ten, this.all_user[i].ma_tai_khoan, this.all_user[i].hinh));\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public clearAdded(ma_tai_khoan: string) {\r\n    let index = -1;\r\n    for (let i = 0; i < this.user_added.length; i++) {\r\n      if (this.user_added[i].ma_tai_khoan == ma_tai_khoan) {\r\n        index = i;\r\n        break;\r\n      }\r\n    }\r\n    if (index != -1) {\r\n      this.user_added.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public updateSearch(ten_hien_tai: string, ma_tai_khoan: string) {\r\n    let ma_tai_khoan_dn_ws = JSON.parse(localStorage.getItem(\"ma_tai_khoan_dn_ws\"));\r\n    if (ten_hien_tai.trim().length > 0) {\r\n      for (let i = 0; i < this.all_user.length; i++) {\r\n        if (this.all_user[i].ma_tai_khoan != ma_tai_khoan_dn_ws) {\r\n          if (this.all_user[i].ma_tai_khoan == ma_tai_khoan) {\r\n            let ten = this.all_user[i].ten;\r\n            if (ten.trim().toLowerCase().includes(ten_hien_tai.trim().toLowerCase())) {\r\n              this.user_search.push(new ChatPageObjectGroupWS(this.all_user[i].ten, this.all_user[i].ma_tai_khoan, this.all_user[i].hinh));\r\n            }\r\n            return;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public isNotInAdded(ma_tai_khoan: string) {\r\n    for (let i = 0; i < this.user_added.length; i++) {\r\n      if (this.user_added[i].ma_tai_khoan == ma_tai_khoan) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public selectUser(ma_tai_khoan: string) {\r\n    for (let i = 0; i < this.all_user.length; i++) {\r\n      if (this.all_user[i].ma_tai_khoan == ma_tai_khoan) {\r\n        this.user_added.push(new ChatPageObjectGroupWS(this.all_user[i].ten, this.all_user[i].ma_tai_khoan, this.all_user[i].hinh));\r\n        this.user_search = [];\r\n        return;\r\n      }\r\n    }\r\n   \r\n  }\r\n\r\n  public getAllUser() {\r\n    return this.db.object(\"/tai_khoan_ws\").snapshotChanges();\r\n  }\r\n\r\n  public off(): void {\r\n    this.isshow = false;\r\n    this.init();\r\n  }\r\n\r\n  public init(): void {\r\n    this.user_added = [];\r\n    this.user_search = [];\r\n  }\r\n\r\n  public isOke(): boolean {\r\n    return this.user_added.length != 0;\r\n  }\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}