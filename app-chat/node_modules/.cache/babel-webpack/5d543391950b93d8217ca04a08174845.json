{"ast":null,"code":"import _asyncToGenerator from \"E:/Important/FIT/project-front-end/FrontEnd_ThayLong_Nhom-21/app-chat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { UserVideo } from 'src/app/models/chat-page/call-video/user-video';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/database\";\nexport class CallVideoService {\n  constructor(db) {\n    this.db = db; // Request mediaDevices\n\n    this.mediaConstraints = {\n      audio: true,\n      video: true\n    }; // All user\n\n    this.all_user = [];\n\n    if (this.layAllUser == null) {\n      this.getData();\n    } else {\n      this.layAllUser.unsubscribe();\n      this.getData();\n    }\n  }\n\n  getData() {\n    this.layAllUser = this.db.object(\"/call_video\").snapshotChanges().subscribe(data => {\n      let array = [];\n      Object.entries(data.payload.toJSON()).forEach(([k, v]) => {\n        let o = new UserVideo();\n        o.ma_tai_khoan = k;\n        o.bat_may_chua = v['bat_may_chua'];\n        o.goi_chua = v['goi_chua'];\n        o.thoi_gian_goi = v['thoi_gian_goi'];\n        o.thoi_gian_ket_thuc = v['thoi_gian_ket_thuc'];\n        array.push(o);\n      });\n      this.all_user = array;\n    });\n  }\n\n  callVideo() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.localStream = yield navigator.mediaDevices.getUserMedia(_this.mediaConstraints);\n      _this.is_show = true;\n    })();\n  }\n\n  startVideo() {\n    this.is_close_camera = false;\n    this.localStream.getTracks().forEach(function (track) {\n      track.enabled = true;\n    });\n  }\n\n  offVideo() {\n    this.is_close_camera = true;\n    this.localStream.getTracks().forEach(function (track) {\n      track.enabled = false;\n    });\n  }\n\n  close() {\n    this.is_show = false;\n    this.localStream.getTracks().forEach(function (track) {\n      track.stop();\n    });\n    this.is_close_camera = false;\n  }\n\n  cameraGoToLeft() {\n    this.is_camera_go_to_left = !this.is_camera_go_to_left;\n  }\n\n}\n\nCallVideoService.ɵfac = function CallVideoService_Factory(t) {\n  return new (t || CallVideoService)(i0.ɵɵinject(i1.AngularFireDatabase));\n};\n\nCallVideoService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CallVideoService,\n  factory: CallVideoService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["E:\\Important\\FIT\\project-front-end\\FrontEnd_ThayLong_Nhom-21\\app-chat\\src\\app\\service\\chat-page\\call-video\\call-video.service.ts"],"names":[],"mappings":";AAGA,SAAS,SAAT,QAA0B,gDAA1B;;;AAKA,OAAM,MAAO,gBAAP,CAAuB;AAyB3B,EAAA,WAAA,CACU,EADV,EACgC;AAAtB,SAAA,EAAA,GAAA,EAAA,CAAsB,CAxBhC;;AACO,SAAA,gBAAA,GAAmB;AACxB,MAAA,KAAK,EAAE,IADiB;AAExB,MAAA,KAAK,EAAE;AAFiB,KAAnB,CAuByB,CAPhC;;AACO,SAAA,QAAA,GAAwB,EAAxB;;AAQL,QAAG,KAAK,UAAL,IAAmB,IAAtB,EAA2B;AACzB,WAAK,OAAL;AACD,KAFD,MAEK;AACH,WAAK,UAAL,CAAgB,WAAhB;AACA,WAAK,OAAL;AACD;AACF;;AAEM,EAAA,OAAO,GAAA;AACZ,SAAK,UAAL,GAAkB,KAAK,EAAL,CAAQ,MAAR,CAAe,aAAf,EAA8B,eAA9B,GAAgD,SAAhD,CAA0D,IAAI,IAAE;AAChF,UAAI,KAAK,GAAa,EAAtB;AACA,MAAA,MAAM,CAAC,OAAP,CAAe,IAAI,CAAC,OAAL,CAAa,MAAb,EAAf,EAAsC,OAAtC,CAA8C,CAAC,CAAC,CAAD,EAAG,CAAH,CAAD,KAAU;AACtD,YAAI,CAAC,GAAG,IAAI,SAAJ,EAAR;AACA,QAAA,CAAC,CAAC,YAAF,GAAiB,CAAjB;AACA,QAAA,CAAC,CAAC,YAAF,GAAiB,CAAC,CAAC,cAAD,CAAlB;AACA,QAAA,CAAC,CAAC,QAAF,GAAa,CAAC,CAAC,UAAD,CAAd;AACA,QAAA,CAAC,CAAC,aAAF,GAAkB,CAAC,CAAC,eAAD,CAAnB;AACA,QAAA,CAAC,CAAC,kBAAF,GAAuB,CAAC,CAAC,oBAAD,CAAxB;AACA,QAAA,KAAK,CAAC,IAAN,CAAW,CAAX;AACD,OARD;AASA,WAAK,QAAL,GAAgB,KAAhB;AACD,KAZiB,CAAlB;AAaD;;AAEY,EAAA,SAAS,GAAA;AAAA;;AAAA;AACpB,MAAA,KAAI,CAAC,WAAL,SAAyB,SAAS,CAAC,YAAV,CAAuB,YAAvB,CAAoC,KAAI,CAAC,gBAAzC,CAAzB;AACA,MAAA,KAAI,CAAC,OAAL,GAAe,IAAf;AAFoB;AAGrB;;AAEM,EAAA,UAAU,GAAA;AACf,SAAK,eAAL,GAAuB,KAAvB;AACA,SAAK,WAAL,CAAiB,SAAjB,GAA6B,OAA7B,CAAqC,UAAU,KAAV,EAAe;AAClD,MAAA,KAAK,CAAC,OAAN,GAAgB,IAAhB;AACD,KAFD;AAGD;;AAEM,EAAA,QAAQ,GAAA;AACb,SAAK,eAAL,GAAuB,IAAvB;AACA,SAAK,WAAL,CAAiB,SAAjB,GAA6B,OAA7B,CAAqC,UAAU,KAAV,EAAe;AAClD,MAAA,KAAK,CAAC,OAAN,GAAgB,KAAhB;AACD,KAFD;AAGD;;AAEM,EAAA,KAAK,GAAA;AACV,SAAK,OAAL,GAAe,KAAf;AACA,SAAK,WAAL,CAAiB,SAAjB,GAA6B,OAA7B,CAAqC,UAAU,KAAV,EAAe;AAClD,MAAA,KAAK,CAAC,IAAN;AACD,KAFD;AAGA,SAAK,eAAL,GAAuB,KAAvB;AACD;;AAEM,EAAA,cAAc,GAAA;AACnB,SAAK,oBAAL,GAA4B,CAAC,KAAK,oBAAlC;AACD;;AAjF0B;;;mBAAhB,gB,EAAgB,EAAA,CAAA,QAAA,CAAA,EAAA,CAAA,mBAAA,C;AAAA,C;;;SAAhB,gB;AAAgB,EAAA,OAAA,EAAhB,gBAAgB,CAAA,I;AAAA,EAAA,UAAA,EAFf","sourcesContent":["import { AngularFireDatabase } from '@angular/fire/database';\r\nimport { Subscription } from 'rxjs';\r\nimport { Injectable } from '@angular/core';\r\nimport { UserVideo } from 'src/app/models/chat-page/call-video/user-video';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CallVideoService {\r\n\r\n  // Request mediaDevices\r\n  public mediaConstraints = {\r\n    audio: true,\r\n    video: true\r\n  }\r\n\r\n  // localStream\r\n  public localStream: MediaStream;\r\n\r\n  // is show component call video\r\n  public is_show: boolean;\r\n\r\n  // Trạng thái camera bật hay tắt\r\n  public is_close_camera: boolean;\r\n  // Trạng thái my camera go to left\r\n  public is_camera_go_to_left: boolean;\r\n\r\n  // All user\r\n  public all_user: UserVideo[] = [];\r\n\r\n  // service\r\n  public layAllUser: Subscription;\r\n\r\n  constructor(\r\n    private db:AngularFireDatabase\r\n  ) {\r\n    if(this.layAllUser == null){\r\n      this.getData();\r\n    }else{\r\n      this.layAllUser.unsubscribe();\r\n      this.getData();\r\n    }\r\n  }\r\n\r\n  public getData(){\r\n    this.layAllUser = this.db.object(\"/call_video\").snapshotChanges().subscribe(data=>{\r\n      let array:UserVideo[]=[];\r\n      Object.entries(data.payload.toJSON()).forEach(([k,v]) => {\r\n        let o = new UserVideo();\r\n        o.ma_tai_khoan = k;\r\n        o.bat_may_chua = v['bat_may_chua'];\r\n        o.goi_chua = v['goi_chua'];\r\n        o.thoi_gian_goi = v['thoi_gian_goi'];\r\n        o.thoi_gian_ket_thuc = v['thoi_gian_ket_thuc'];\r\n        array.push(o);\r\n      });\r\n      this.all_user = array;\r\n    })\r\n  }\r\n\r\n  public async callVideo() {\r\n    this.localStream = await navigator.mediaDevices.getUserMedia(this.mediaConstraints);\r\n    this.is_show = true;\r\n  }\r\n\r\n  public startVideo() {\r\n    this.is_close_camera = false\r\n    this.localStream.getTracks().forEach(function (track) {\r\n      track.enabled = true;\r\n    });\r\n  }\r\n\r\n  public offVideo() {\r\n    this.is_close_camera = true;\r\n    this.localStream.getTracks().forEach(function (track) {\r\n      track.enabled = false;\r\n    });\r\n  }\r\n\r\n  public close() {\r\n    this.is_show = false;\r\n    this.localStream.getTracks().forEach(function (track) {\r\n      track.stop();\r\n    });\r\n    this.is_close_camera = false;\r\n  }\r\n\r\n  public cameraGoToLeft() {\r\n    this.is_camera_go_to_left = !this.is_camera_go_to_left;\r\n  }\r\n\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}